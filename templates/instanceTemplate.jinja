resources:
- name: {{ env["name"] }}
  type: compute.v1.instanceTemplate
  properties:
    properties:
      project: {{ env["project"] }}
      machineType: n1-standard-1
      canIpForward: true
      properties:
        zone: {{ properties["zone"] }}
      disks:
      - deviceName: boot
        type: PERSISTENT
        boot: true
        autoDelete: true
        initializeParams:
          sourceImage: projects/debian-cloud/global/images/family/debian-8
      networkInterfaces:
      - network: projects/{{ env["project"] }}/global/networks/default
        # Access Config required to give the instance a public IP address
        accessConfigs:
        - natIP: {{ properties["ip"] }}
      tags:
        items: ["natgw"]
      metadata:
        items:
        # taken from https://github.com/GoogleCloudPlatform/deploymentmanager-samples/tree/master/examples/v2/metadata_from_file
        {% for key, value in properties['metadata-from-file'].iteritems() %}
        - key: {{ key }}
          value: |
            {{ imports[value]|indent(12) }}
      {% endfor %}